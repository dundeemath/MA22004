{
  "hash": "31428117da23dbf0eb9823e45c877489",
  "result": {
    "engine": "knitr",
    "markdown": "\n\n\\DeclareMathOperator{\\E}{\\mathbf{E}}\n\\DeclareMathOperator{\\Var}{Var}\n\\DeclareMathOperator{\\Cov}{Cov}\n\\DeclareMathOperator{\\corr}{corr}\n\\DeclareMathOperator{\\sd}{sd}\n\\newcommand{\\se}{\\mathsf{se}}\n\n\n\n\n\n\n# Quality control {#sec-quality-control}\n\nQuality control is an area of applied statistics that makes interventions to maintain or improve the outcome of industrial processes. Random variations in output processes might negatively impact the quality of a product. We want to identify the sources of random output-process variations that might have *assignable causes*. Control charts are a tool that helps us to recognise when industrial processes are no longer controlled so that one might then seek to identify assignable causes. \n\n## Control charts {#sec-control-charts} \n\nThe essential elements of control charting involve specifying a control region and then analysing time-series data. We will specify a baseline value along with an upper and lower control limit and assume that a process is under control unless a test statistic suggests otherwise. To construct a control chart, one collects data about a process at fixed points of time and calculates the running value of a quality statistic. Suppose the quality statistic exceeds the upper or lower control limits. In that case, the process is deemed out of control, and the product quality is assumed to be negatively impacted.\n\n:::{.callout-important}\n## Default position\n\nThe default position adopted for quality control will be reminiscent of hypothesis testing: \"assume that a process is under control unless a test statistic suggests otherwise.\"\n:::\n\nThe process of creating a control chart is best illustrated through an extended example, like @exm-qc-three-sigma provided below. \n\n:::{#exm-qc-three-sigma}\nHere we consider the typical $3 \\sigma$ control charting for a process mean $\\overline{X}$ based on estimated parameters. That is, we assume the generating process $X$ is normally distributed with unknown parameters $\\mu$ and $\\sigma^2$. We seek to estimate the mean $\\overline{X}$. Our control region is specified to be three standard deviations; the process is in control if it remains within three standard deviations of a baseline value.\n\n:::{#nte-beer .callout-note collapse=\"true\"}\n## Beer Production Data \n\nThe **Beer Production Data** contains measurements of the features OG, ABV, pH, and IBU for $50$ batches of each of three types of product (Premium Lager, IPA, and Light Lager).\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nbeer |> glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 150\nColumns: 6\n$ Batch_Id <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, …\n$ OG       <dbl> 5.1, 4.9, 4.7, 4.6, 5.0, 5.4, 4.6, 5.0, 4.4, 4.9, 5.4, 4.8, 4.8, 4.3, 5…\n$ ABV      <dbl> 3.5, 3.0, 3.2, 3.1, 3.6, 3.9, 3.4, 3.4, 2.9, 3.1, 3.7, 3.4, 3.0, 3.0, 4…\n$ pH       <dbl> 1.4, 1.4, 1.3, 1.5, 1.4, 1.7, 1.4, 1.5, 1.4, 1.5, 1.5, 1.6, 1.4, 1.1, 1…\n$ IBU      <dbl> 9.0, 10.0, 7.0, 9.0, 8.0, 7.7, 7.4, 7.1, 6.8, 6.5, 6.2, 5.9, 5.6, 5.3, …\n$ Beer     <chr> \"Premium Lager\", \"Premium Lager\", \"Premium Lager\", \"Premium Lager\", \"Pr…\n```\n\n\n:::\n:::\n\n:::\n\nLet's consider the Beer Production Data in @nte-beer. We are interested in the IPA's pH value, which influences saccharification. We assume that three batches of IPA are produced per day, and we prepare the data as follows.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nipa <- beer |> \n select(Batch_Id, pH, Beer) |> \n filter(Beer == \"IPA\") |> \n rename(Day = Batch_Id)\n\nm <- 3    # three batches per day\nk <- 16   # number of days\nipa$Day[1:(m*k)] <- rep(1:k, each = m)\nipa <- ipa[1:(m*k),]\n```\n:::\n\n\nThe prepared data, `ipa`, is summarized in the @tbl-qc-beer-data. \n\n\n::: {#tbl-qc-beer-data .cell layout-align=\"center\" tbl-cap='Observations and summary statistics for the **Beer Production Data**.'}\n\n```{.r .cell-code}\nipa_stat <- ipa |> \n group_by(Day) |> \n summarise(obs = list(pH), mean = signif(mean(pH), digits = 4), \n           sd = signif(sd(pH), digits = 4), range = max(pH) - min(pH)) \nipa_stat |> \n kbl(align = \"rcccc\", booktabs = T, escape = F) |>\n kable_styling(latex_options = c(\"striped\", \"hold_position\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> Day </th>\n   <th style=\"text-align:center;\"> obs </th>\n   <th style=\"text-align:center;\"> mean </th>\n   <th style=\"text-align:center;\"> sd </th>\n   <th style=\"text-align:center;\"> range </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:center;\"> 4.7, 4.5, 4.9 </td>\n   <td style=\"text-align:center;\"> 4.700 </td>\n   <td style=\"text-align:center;\"> 0.20000 </td>\n   <td style=\"text-align:center;\"> 0.4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:center;\"> 4.0, 4.6, 4.5 </td>\n   <td style=\"text-align:center;\"> 4.367 </td>\n   <td style=\"text-align:center;\"> 0.32150 </td>\n   <td style=\"text-align:center;\"> 0.6 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:center;\"> 4.7, 3.3, 4.6 </td>\n   <td style=\"text-align:center;\"> 4.200 </td>\n   <td style=\"text-align:center;\"> 0.78100 </td>\n   <td style=\"text-align:center;\"> 1.4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:center;\"> 3.9, 3.5, 4.2 </td>\n   <td style=\"text-align:center;\"> 3.867 </td>\n   <td style=\"text-align:center;\"> 0.35120 </td>\n   <td style=\"text-align:center;\"> 0.7 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:center;\"> 4.0, 4.7, 3.6 </td>\n   <td style=\"text-align:center;\"> 4.100 </td>\n   <td style=\"text-align:center;\"> 0.55680 </td>\n   <td style=\"text-align:center;\"> 1.1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:center;\"> 4.4, 4.5, 4.1 </td>\n   <td style=\"text-align:center;\"> 4.333 </td>\n   <td style=\"text-align:center;\"> 0.20820 </td>\n   <td style=\"text-align:center;\"> 0.4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 7 </td>\n   <td style=\"text-align:center;\"> 4.5, 3.9, 4.8 </td>\n   <td style=\"text-align:center;\"> 4.400 </td>\n   <td style=\"text-align:center;\"> 0.45830 </td>\n   <td style=\"text-align:center;\"> 0.9 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 8 </td>\n   <td style=\"text-align:center;\"> 4.0, 4.9, 4.7 </td>\n   <td style=\"text-align:center;\"> 4.533 </td>\n   <td style=\"text-align:center;\"> 0.47260 </td>\n   <td style=\"text-align:center;\"> 0.9 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 9 </td>\n   <td style=\"text-align:center;\"> 4.3, 4.4, 4.8 </td>\n   <td style=\"text-align:center;\"> 4.500 </td>\n   <td style=\"text-align:center;\"> 0.26460 </td>\n   <td style=\"text-align:center;\"> 0.5 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 10 </td>\n   <td style=\"text-align:center;\"> 5.0, 4.5, 3.5 </td>\n   <td style=\"text-align:center;\"> 4.333 </td>\n   <td style=\"text-align:center;\"> 0.76380 </td>\n   <td style=\"text-align:center;\"> 1.5 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 11 </td>\n   <td style=\"text-align:center;\"> 3.8, 3.7, 3.9 </td>\n   <td style=\"text-align:center;\"> 3.800 </td>\n   <td style=\"text-align:center;\"> 0.10000 </td>\n   <td style=\"text-align:center;\"> 0.2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 12 </td>\n   <td style=\"text-align:center;\"> 5.1, 4.5, 4.5 </td>\n   <td style=\"text-align:center;\"> 4.700 </td>\n   <td style=\"text-align:center;\"> 0.34640 </td>\n   <td style=\"text-align:center;\"> 0.6 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 13 </td>\n   <td style=\"text-align:center;\"> 4.7, 4.4, 4.1 </td>\n   <td style=\"text-align:center;\"> 4.400 </td>\n   <td style=\"text-align:center;\"> 0.30000 </td>\n   <td style=\"text-align:center;\"> 0.6 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 14 </td>\n   <td style=\"text-align:center;\"> 4.0, 4.4, 4.6 </td>\n   <td style=\"text-align:center;\"> 4.333 </td>\n   <td style=\"text-align:center;\"> 0.30550 </td>\n   <td style=\"text-align:center;\"> 0.6 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 15 </td>\n   <td style=\"text-align:center;\"> 4.0, 3.3, 4.2 </td>\n   <td style=\"text-align:center;\"> 3.833 </td>\n   <td style=\"text-align:center;\"> 0.47260 </td>\n   <td style=\"text-align:center;\"> 0.9 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 16 </td>\n   <td style=\"text-align:center;\"> 4.2, 4.2, 4.3 </td>\n   <td style=\"text-align:center;\"> 4.233 </td>\n   <td style=\"text-align:center;\"> 0.05774 </td>\n   <td style=\"text-align:center;\"> 0.1 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nWe first observe that the pH measurements are (at least approximately) normal, as seen in the quantile-quantile plot in @fig-qc-beer-pH-norm.   \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nipa |> ggplot(aes(sample = pH)) + stat_qq() + stat_qq_line()\n```\n\n::: {.cell-output-display}\n![Normal quantile-quantile plot of observed pH measurements of the IPA batches.](08-quality-control_files/figure-html/fig-qc-beer-pH-norm-1.svg){#fig-qc-beer-pH-norm fig-align='center' width=672}\n:::\n:::\n\n\nWe consider the data for pH readings from three batches of IPA taken over sixteen days ($k = 16$) presented in @tbl-qc-beer-data. The Table includes the sample mean per day, $\\overline{x}$, the sample standard deviation, $s$, and the range of values per day, $\\max{x_i} - \\min{x_i}$ (each based on $m=3$ batches).   \n\nWe estimate the mean  \n$$\n \\widehat{\\mu} = \\frac{1}{k} \\sum_{i=1}^k \\overline{x}_i \\,,\n$$\nby averaging the means found for the $k$ days and, similarly, estimating the mean of the sample standard deviation,\n$$\n \\overline{s} = \\frac{1}{k} \\sum_{i=1}^k s_i\\,,\n$$\nby averaging the sample standard deviations for the $k$ days. It can be shown that \n$$\n \\widehat{\\sigma} = \\frac{\\overline{S}}{a_m} \n$$\nis an unbiased estimator of $\\sigma$ where\n$$\na_m = \\frac{\\sqrt{2} \\Gamma(m/2)}{\\sqrt{m-1}\\Gamma\\left((n-1)/2\\right)}\\,.\n$$\nThus, we compute the $3\\sigma$ upper and lower control limits, respectively,\n$$\n \\mathsf{UCL} = \\widehat{\\mu} + 3 \\frac{\\overline{s}}{a_m \\sqrt{m}}\n$$\nand \n$$\n \\mathsf{LCL} = \\widehat{\\mu} - 3 \\frac{\\overline{s}}{a_m \\sqrt{m}} \\,.\n$$\nThe computations in `r` follow, along with the resulting control chart in @fig-qc-beer-control-chart.   \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\na <- function(m){ sqrt(2) * gamma(m/2) / (sqrt(m-1) * gamma((m-1)/2)) }\nmuhat = sum(ipa_stat$mean) / k\nsbar = sum(ipa_stat$sd) / k\nlcl = muhat - 3*sbar / (a(m) * sqrt(m))\nucl = muhat + 3*sbar / (a(m) * sqrt(m))\n\nggplot(ipa_stat, aes(x = Day)) + geom_point(aes(y = mean)) + \n geom_hline(aes(yintercept = muhat, color = \"Mean\"), linewidth = lsz) + \n geom_hline(aes(yintercept = lcl, color = \"LCL\"), linewidth = lsz*1.5) + \n geom_hline(aes(yintercept = ucl, color = \"UCL\"), linewidth = lsz*1.5) + ylab(\"pH\") + \n   theme(legend.justification = c(1,1), legend.position = c(1,1),\n         legend.title = element_blank(), \n         legend.box.margin = margin(c(4, 4, 4, 4), unit = \"pt\"))\n```\n\n::: {.cell-output-display}\n![The $3\\sigma$ control chart illustrates that with respect to pH the brewing process is in-control over the selected timeframe as the observations fall within the $(\\mathsf{LCL}, \\mathsf{UCL})$ control interval.](08-quality-control_files/figure-html/fig-qc-beer-control-chart-1.svg){#fig-qc-beer-control-chart fig-align='center' width=672}\n:::\n:::\n\n\nFrom @fig-qc-beer-control-chart, we observe for each day the process is in-control as the observed mean pH values fall within the control limits $(\\mathsf{LCL}, \\mathsf{UCL})$. If this were not the case, our initial assumption that the process is in control would be violated. The violation of the assumption would require that we seek to identify an assignable cause for the variation. If a cause could be identified, we would need to recompute our control limits with the observations that were out of control removed.\n:::\n",
    "supporting": [
      "08-quality-control_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}